Author: Daniel Baumann <daniel.baumann@progress-technologies.net>
Description: Improving debian default container config.

diff -Naurp lxc.orig/templates/lxc-debian.in lxc/templates/lxc-debian.in
--- lxc.orig/templates/lxc-debian.in	2011-11-07 10:28:41.540436153 +0100
+++ lxc/templates/lxc-debian.in	2011-11-07 10:28:12.064279464 +0100
@@ -217,30 +217,74 @@ copy_configuration()
     rootfs=$2
     name=$3
 
-    cat <<EOF >> $path/config
-lxc.tty = 4
-lxc.pts = 1024
-lxc.rootfs = $rootfs
-lxc.cgroup.devices.deny = a
-# /dev/null and zero
-lxc.cgroup.devices.allow = c 1:3 rwm
-lxc.cgroup.devices.allow = c 1:5 rwm
-# consoles
-lxc.cgroup.devices.allow = c 5:1 rwm
-lxc.cgroup.devices.allow = c 5:0 rwm
-lxc.cgroup.devices.allow = c 4:0 rwm
-lxc.cgroup.devices.allow = c 4:1 rwm
+    cat >> $path/config << EOF
+# $path/config
+
+## Container
+lxc.utsname                             = $name
+lxc.rootfs                              = $rootfs
+lxc.tty                                 = 4
+lxc.pts                                 = 1024
+#lxc.console                            = /var/log/lxc/$name.console
+
+## Capabilities
+lxc.cap.drop                            = sys_admin
+
+## Devices
+# Allow all devices
+#lxc.cgroup.devices.allow               = a
+# Deny all devices
+lxc.cgroup.devices.deny                 = a
+# Allow to mknod all devices (but not using them)
+lxc.cgroup.devices.allow = c *:* m
+lxc.cgroup.devices.allow = b *:* m
+# /dev/null
+lxc.cgroup.devices.allow                = c 1:3 rwm
+# /dev/zero
+lxc.cgroup.devices.allow                = c 1:5 rwm
+# /dev/tty[1-4] consoles
+lxc.cgroup.devices.allow                = c 5:1 rwm
+lxc.cgroup.devices.allow                = c 5:0 rwm
+lxc.cgroup.devices.allow                = c 4:0 rwm
+lxc.cgroup.devices.allow                = c 4:1 rwm
 # /dev/{,u}random
-lxc.cgroup.devices.allow = c 1:9 rwm
-lxc.cgroup.devices.allow = c 1:8 rwm
-lxc.cgroup.devices.allow = c 136:* rwm
-lxc.cgroup.devices.allow = c 5:2 rwm
-# rtc
-lxc.cgroup.devices.allow = c 254:0 rwm
-
-# mounts point
-lxc.mount.entry=proc $rootfs/proc proc nodev,noexec,nosuid 0 0
-lxc.mount.entry=sysfs $rootfs/sys sysfs defaults  0 0
+lxc.cgroup.devices.allow                = c 1:9 rwm
+lxc.cgroup.devices.allow                = c 1:8 rwm
+lxc.cgroup.devices.allow                = c 136:* rwm
+lxc.cgroup.devices.allow                = c 5:2 rwm
+# /dev/rtc
+lxc.cgroup.devices.allow                = c 254:0 rwm
+
+## Limits
+#lxc.cgroup.cpu.shares                  = 1024
+#lxc.cgroup.cpuset.cpus                 = 0
+#lxc.cgroup.memory.limit_in_bytes       = 256M
+#lxc.cgroup.memory.memsw.limit_in_bytes = 1G
+
+## Filesystem
+lxc.mount.entry                         = proc $rootfs/proc proc nodev,noexec,nosuid 0 0
+lxc.mount.entry                         = sysfs $rootfs/sys sysfs defaults,ro 0 0
+EOF
+
+    # Adding shared data directory if existing
+    if [ -d /srv/share/$hostname ]; then
+	echo "lxc.mount.entry                         = /srv/share/$hostname $rootfs/srv/$hostname none defaults,bind 0 0" >> $path/config
+    else
+	echo "#lxc.mount.entry                        = /srv/share/$hostname $rootfs/srv/$hostname none defaults,bind 0 0" >> $path/config
+    fi
+
+    cat >> $path/config << EOF
+
+#lxc.mount.entry                        = /srv/$name $rootfs/srv/$name none defaults,bind 0 0
+
+## Network
+lxc.network.type                        = veth
+lxc.network.flags                       = up
+lxc.network.hwaddr                      = 11:22:33:44:55:66
+lxc.network.link                        = br0
+lxc.network.mtu                         = 1500
+lxc.network.name                        = eth0
+lxc.network.veth.pair                   = veth-$name
 EOF
 
     if [ $? -ne 0 ]; then
